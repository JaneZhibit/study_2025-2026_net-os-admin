---
# Preamble

## Author
author:
  name: Жибицкая Евгения Дмитриевна
  degrees: 
  orcid: 0000-0002-0877-7063
  email: 
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Лабораторная работа №13"
subtitle: "Настройка NFS"
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Продолжение работы с Rocky Linux. Приобретение навыков настройки сервера NFS для удалённого доступа к ресурсам.

# Выполнение лабораторной работы

## 13.4.1. Настройка сервера NFSv4

Установим необходимое программное обеспечение на сервере ([рис. @fig-001]):

![Установка nfs-utils на сервере](image/1.jpg){#fig-001 width=70%}

Создадим каталог для общего доступа и настроим экспорт в файле /etc/exports ([рис. @fig-002]):

![Создание каталога /srv/nfs и настройка exports](image/2.jpg){#fig-002 width=70%}

Настроим контекст безопасности SELinux для общего каталога ([рис. @fig-003]):

![Настройка SELinux для NFS](image/3.jpg){#fig-003 width=70%}

Запустим сервер NFS и настроим межсетевой экран ([рис. @fig-004]):

![Запуск NFS-сервера и настройка firewall](image/4.jpg){#fig-004 width=70%}

Установим nfs-utils на клиенте ([рис. @fig-005]):

![Установка nfs-utils на клиенте](image/5.jpg){#fig-005 width=70%}

Проверим доступность экспортируемых ресурсов с клиента ([рис. @fig-006]):

![Проверка экспортируемых ресурсов](image/6.jpg){#fig-006 width=70%}

При первоначальной проверке возникает ошибка "RPC: Unable to receive", что связано с блокировкой доступа межсетевым экраном.

 Остановим межсетевой экран на сервере и повторно проверим доступность ресурсов ([рис. @fig-007]):

![Проверка после отключения firewall](image/7.jpg){#fig-007 width=70%}

После отключения межсетевого экрана ресурсы становятся доступными для просмотра.

 Запустим межсетевой экран и добавим необходимые службы в настройки firewall ([рис. @fig-008] и [рис. @fig-009]):

![Просмотр TCP-соединений](image/8.jpg){#fig-008 width=70%}

![Добавление служб mountd и rpc-bind в firewall](image/9.jpg){#fig-009 width=70%}

 Проверим подключение после настройки firewall ([рис. @fig-010]):

![Успешная проверка экспорта после настройки firewall](image/10.jpg){#fig-010 width=70%}

## 13.4.2. Монтирование NFS на клиенте

Создадим точку монтирования и подключим удалённый ресурс ([рис. @fig-011]):

![Монтирование NFS на клиенте](image/11.jpg){#fig-011 width=70%}

 Проверим информацию о монтировании ([рис. @fig-012]):

![Проверка mounted файловых систем](image/12.jpg){#fig-012 width=70%}

В выводе команды mount видно, что ресурс server.edzhibitskaya.net:/srv/nfs успешно смонтирован в /mnt/nfs с использованием NFS версии 4.2, протокола TCP, с параметрами rsize=262144, wsize=262144, что указывает на оптимальные размеры чтения/записи.

 Добавим запись в /etc/fstab для автоматического монтирования ([рис. @fig-013]):

![Настройка автоматического монтирования в fstab](image/13.jpg){#fig-013 width=70%}

Синтаксис записи: server.edzhibitskaya.net:/srv/nfs - удалённый ресурс, /mnt/nfs - точка монтирования, nfs - тип файловой системы, _netdev - опция, указывающая что это сетевое устройство (монтирование будет отложено до загрузки сети), 0 0 - параметры dump и fsck.

Проверим статус службы удалённых файловых систем ([рис. @fig-014]):

![Проверка remote-fs.target](image/14.jpg){#fig-014 width=70%}

## 13.4.3. Подключение каталогов к дереву NFS

Создадим и подключим каталог веб-сервера к NFS ([рис. @fig-015]):

![Создание каталога www и bind-монтирование](image/15.jpg){#fig-015 width=70%}

Добавим экспорт каталога www и обновим конфигурацию ([рис. @fig-016]):

![Настройка экспорта каталога www](image/16.jpg){#fig-016 width=70%}

Проверим доступность каталога на клиенте ([рис. @fig-017]):

![Проверка каталога www на клиенте](image/17.jpg){#fig-017 width=70%}

Добавим запись в fstab для автоматического монтирования каталога www ([рис. @fig-018]):

![Добавление bind-монтирования в fstab](image/18.jpg){#fig-018 width=70%}

## 13.4.4. Подключение каталогов для работы пользователей

Создадим личный каталог пользователя и файл ([рис. @fig-019]):

![Создание личного каталога пользователя](image/19.jpg){#fig-019 width=70%}

Создадим общий каталог в NFS и выполним bind-монтирование ([рис. @fig-020]):

![Bind-монтирование домашнего каталога](image/20.jpg){#fig-020 width=70%}

На каталог установлены права доступа 700 (только владелец), что обеспечивает безопасность личных данных пользователя.

Добавим экспорт каталога пользователя ([рис. @fig-021]):

![Экспорт домашнего каталога пользователя](image/21.jpg){#fig-021 width=70%}

Добавим запись в fstab ([рис. @fig-022]):

![Настройка fstab для домашнего каталога](image/22.jpg){#fig-022 width=70%}

Проверим доступность каталогов на клиенте ([рис. @fig-023]):

![Проверка каталогов на клиенте](image/23.jpg){#fig-023 width=70%}

Создадим файл от имени пользователя и проверим доступ от root ([рис. @fig-024]):

![Создание файла и проверка прав доступа](image/24.jpg){#fig-024 width=70%}

Пользователь edzhibitskaya успешно создал файл в смонтированном каталоге, в то время как пользователь root получил отказ в доступе, что демонстрирует корректную работу механизмов безопасности NFS.

Проверим появление файлов на сервере ([рис. @fig-025]):

![Проверка файлов на сервере](image/25.jpg){#fig-025 width=70%}

## 13.4.5. Внесение изменений в настройки внутреннего окружения виртуальных машин

Создадим структуру каталогов и скопируем конфигурационные файлы ([рис. @fig-026]):

![Подготовка каталогов для provision](image/26.jpg){#fig-026 width=70%}

Создадим скрипт настройки NFS для сервера ([рис. @fig-027]):

![Скрипт настройки NFS для сервера](image/27.jpg){#fig-027 width=70%}

Создадим скрипт настройки NFS для клиента ([рис. @fig-028]):

![Скрипт настройки NFS для клиента](image/28.jpg){#fig-028 width=70%}

Настроим provision в Vagrantfile ([рис. @fig-029] и [рис. @fig-030]):

![Конфигурация provision для сервера](image/29.jpg){#fig-029 width=70%}

![Конфигурация provision для клиента](image/30.jpg){#fig-030 width=70%}


# Контрольные вопросы

1. Как называется файл конфигурации, содержащий общие ресурсы NFS?

   Файл конфигурации, содержащий общие ресурсы NFS, называется /etc/exports.

2. Какие порты должны быть открыты в брандмауэре, чтобы обеспечить полный доступ к серверу NFS?

   Для обеспечения полного доступа к серверу NFS должны быть открыты порты для служб:
   - nfs (2049/tcp)
   - mountd (нефиксированный порт, обычно управляется rpcbind)
   - rpc-bind (portmapper, 111/tcp и 111/udp)

3. Какую опцию следует использовать в /etc/fstab, чтобы убедиться, что общие ресурсы NFS могут быть установлены автоматически при перезагрузке?

   Для автоматического монтирования NFS-ресурсов при перезагрузке следует использовать опцию _netdev в файле /etc/fstab. Эта опция указывает системе, что устройство является сетевым, и монтирование должно быть отложено до полной загрузки сетевой подсистемы.

# Выводы

В ходе лабораторной работы были успешно приобретены навыки настройки сервера NFSv4 для удалённого доступа к ресурсам. Были настроен сервер NFSv4, механизмы безопасности SELinux и межсетевого экрана для работы NFS? протестирована работа механизмов безопасности NFS.

# Список литературы{.unnumbered}

[ТУИС](https://esystem.rudn.ru/pluginfile.php/2854782/mod_resource/content/5/013-nfs.pdf)

::: {#refs}
:::
