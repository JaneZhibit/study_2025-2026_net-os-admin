---
# Preamble

## Author
author:
  name: Жибицкая Евгения Дмитриевна
  degrees: 
  orcid: 0000-0002-0877-7063
  email: 
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: "Лабораторная работа №8"
subtitle: "Дисциплина: Администрирование сетевых подсистем"
license: "CC BY"
## Generic options
lang: ru-RU
number-sections: true
toc: true
toc-title: "Содержание"
toc-depth: 2
## Crossref customization
crossref:
  lof-title: "Список иллюстраций"
  lot-title: "Список таблиц"
  lol-title: "Листинги"
## Bibliography
bibliography:
  - bib/cite.bib
csl: _resources/csl/gost-r-7-0-5-2008-numeric.csl
## Formats
format:
### Pdf output format
  pdf:
    toc: true
    number-sections: true
    colorlinks: false
    toc-depth: 2
    lof: true # List of figures
    lot: true # List of tables
#### Document
    documentclass: scrreprt
    papersize: a4
    fontsize: 12pt
    linestretch: 1.5
#### Language
    babel-lang: russian
    babel-otherlangs: english
#### Biblatex
    cite-method: biblatex
    biblio-style: gost-numeric
    biblatexoptions:
      - backend=biber
      - langhook=extras
      - autolang=other*
#### Misc options
    csquotes: true
    indent: true
    header-includes: |
      \usepackage{indentfirst}
      \usepackage{float}
      \floatplacement{figure}{H}
      \usepackage[RM={Scale=0.94},SS={Scale=0.94},SScon={Scale=0.94},TT={Scale=MatchLowercase,FakeStretch=0.9},DefaultFeatures={Ligatures=Common}]{plex-otf}
### Docx output format
  docx:
    toc: true
    number-sections: true
    toc-depth: 2
---

# Цель работы

Продолжение работы с Rocky Linux, приобретение практических навыков по установке и конфигурированию SMTP-сервера.

# Выполнение лабораторной работы

Запустим виртуальную машину сервер для работы ([рис. @fig-001]).

![Запуск](image/1.jpg){#fig-001 width=70%}


Далее устанавливаем необходимые для работы пакеты - postfix, s-nail([рис. @fig-002]).

![Установка пакетов](image/2.jpg){#fig-002 width=70%}

Сконфигурируем межсетвой экран, разрешим работу службе протокола SMTP([рис. @fig-003]).

![Firewall](image/3.jpg){#fig-003 width=70%}

Запускаем Postfix([рис. @fig-004]).

![Запуск службы](image/4.jpg){#fig-004 width=70%}



Переходим к изменению параметров Postfix с помощью postconf



Просматриваем значения параметров, заменяем значение параметра myorigin на значение параметра mydomain, проверям корректность содержания файла и перезапускаем файлы([рис. @fig-005] и [рис. @fig-006]).

![Просмотр и изменение параметров](image/5.jpg){#fig-005 width=70%}


![Проверка и перезапуск](image/6.jpg){#fig-006 width=70%}


Далее просматриваем все параметры с значением, отличным от значения по умолчанию([рис. @fig-007]).

![Просмотр измененных значений](image/7.jpg){#fig-007 width=70%}


Задаем жёстко значение домена, отключаем IPv6 в списке разрешённых в работе Postfix протоколов, отсавляя IPv4, перезагружаем конфигурацию Postfix([рис. @fig-008]).

![Изменение параметров ](image/8.jpg){#fig-008 width=70%}


Перейдем к проверке Postfix.

На сервере под учётной записью пользователя отправляем себе письмо, используя
утилиту mail([рис. @fig-009]). Также запускаем мониторинг работы почтовой службы([рис. @fig-010]) и смотрим наличие каталога с пользователем в /var/spool/mail. Видим, что статус сообщения - отправлено и доставлено, значит все работает корректно([рис. @fig-011]).

![Отправка письма](image/9.jpg){#fig-009 width=70%}

![Мониторинг работы службы ](image/10.jpg){#fig-010 width=70%}


![Каталоги /var/spool/mail](image/11.jpg){#fig-011 width=70%}



Запускаем машину Client, устанавливаем на ней пакеты, отключаем IPv6  и запускаем Postfix([рис. @fig-012] и [рис. @fig-013]).

![Установка пакетов](image/12.jpg){#fig-012 width=70%}

![Запуск службы](image/13.jpg){#fig-013 width=70%}

Отправляем себе еще одно письмо, но уже с клиента, видим, что оно отправлено([рис. @fig-014]).

![Отправка письма](image/14.jpg){#fig-014 width=70%}


Далее на сервере в конфигурации Postfix смотрим значения параметров сетевых интерфейсов и сетевых адресов, разрешаем Postfix прослушивать соединения не только с локального узла, но и с других интерфейсов сети, добавим адрес внутренней сети, разрешив таким образом пересылку сообщений между узлами сети и перезагрузим сервер([рис. @fig-015]).

![Параметры](image/15.jpg){#fig-015 width=70%}


Отправим еще одно сообщение([рис. @fig-016]) и просмотрим лог - команда выполнилась успешно,но  сообщение было поставлено в очередь на отправку ([рис. @fig-017]).

![Отправка письма](image/16.jpg){#fig-016 width=70%}


![Мониторинг](image/17.jpg){#fig-017 width=70%}


Посмотрим какие сообщения ожидают отправку([рис. @fig-018]).

![Очередь](image/18.jpg){#fig-018 width=70%}




Для настройки возможности отправки сообщений не на конкретный узел сети,а на доменный адрес пропишим MX-запись с указанием имени почтового сервера для прямой и обратной зон([рис. @fig-019] и [рис. @fig-020]).

![Прямая зона](image/19.jpg){#fig-019 width=70%}


![Обратная зона](image/20.jpg){#fig-020 width=70%}

В конфигурации Postfix добавим домен в список элементов сети, для которых данный сервер является конечной точкой доставки почты, перезагрузим Postfix, восстановим контекст безопасности([рис. @fig-021] и [рис. @fig-022]).

![Добавление домена](image/21.jpg){#fig-021 width=70%}


![Контекст безопасности](image/22.jpg){#fig-022 width=70%}


Далее попробуем отправить сообщения, находящиеся в очереди и проверим, что все письма отправлены([рис. @fig-023]).

![Проверка писем](image/23.jpg){#fig-023 width=70%}



Наконец, сохраним все изменения - скопируем файлы, создадим исполняемый файл на машинах клиент и сервер([рис. @fig-024] и [рис. @fig-025]), ([рис. @fig-026] и [рис. @fig-027]). Вносим изменения в Vagrantfile для обеих машин([рис. @fig-028]).


![Копирование файлов](image/24.jpg){#fig-024 width=70%}


![Скрипт](image/25.jpg){#fig-025 width=70%}


![Создание файла](image/26.jpg){#fig-026 width=70%}


![Скрипт](image/27.jpg){#fig-027 width=70%}

![Vagrantfile](image/28.jpg){#fig-028 width=70%}



# Контрольные вопросы

1. В каком каталоге и в каком файле следует смотреть конфигурацию Postfix?

Основной каталог: /etc/postfix/
Главные файлы: main.cf и master.cf

2. Каким образом можно проверить корректность синтаксиса в конфигурационном
файле Postfix?

 postfix check и  postfix reload

3. В каких параметрах конфигурации Postfix требуется внести изменения в значениях
для настройки возможности отправки писем не на локальный хост, а на доменные
адреса?

inet_interfaces = all
mydestination = $myhostname, localhost.$mydomain, localhost, $mydomain
relayhost = 

4. Приведите примеры работы с утилитой mail по отправке письма, просмотру имею-
щихся писем, удалению письма.

 Отправка письма
- echo "Текст" | mail -s "Тема" user@domain.com

 Просмотр писем
- mail

Удаление письма (в интерфейсе mail)
- d номер_письма

5. Приведите примеры работы с утилитой postqueue. Как посмотреть очередь сообще-
ний? Как определить число сообщений в очереди? Как отправить все сообщения,
находящиеся в очереди? Как удалить письмо из очереди?

 Просмотр очереди
- sudo postqueue -p

 Число сообщений в очереди
- sudo postqueue -p | grep -c '^[A-F0-9]'

 Отправка всех сообщений
- sudo postqueue -f

 Удаление письма из очереди
- sudo postsuper -d ID_письма

 Удаление ВСЕХ писем из очереди
- sudo postsuper -d ALL


# Выводы

В ходе работы были приобретены практические навыки  по установке и конфигурированию SMTP-сервера, отправлены пиьсма, проверена работоспособность.

# Список литературы{.unnumbered}

[ТУИС](https://esystem.rudn.ru/pluginfile.php/2854762/mod_resource/content/8/008-smtp.pdf)

::: {#refs}
:::
