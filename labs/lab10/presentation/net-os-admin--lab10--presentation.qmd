---
# Preamble

## Author
author:
  name: Жибицкая Евгения Дмитриевна
  degrees: DSc
  orcid: 0000-0002-0877-7063
  email: 1132236130@rudn.ru
  affiliation:
    - name: Российский университет дружбы народов
      country: Российская Федерация
      postal-code: 117198
      city: Москва
      address: ул. Миклухо-Маклая, д. 6
## Title
title: Лабораторная работа №10
subtitle: Администрирование сетевых подсистем
license: CC BY
## Generic options
lang: ru-RU
crossref:
  lof-title: Список иллюстраций
  lot-title: Список таблиц
  lol-title: Листинги
## Formats
format:
### Pdf output format
  beamer:
    toc: true
    colorlinks: false
    toc-depth: 2
    slide_level: 2
    aspectratio: 169
    section-titles: true
    theme: metropolis
    themeoptions: progressbar=frametitle,sectionpage=progressbar,numbering=fraction
#### Language
    babel-lang: russian
    babel-otherlangs: english
### Html output
  revealjs:
    transition: slide
    margin: 0.2
    smaller: false
    output-ext: html
    theme: beige
    logo: _resources/image/logo_rudn.png
---

# Цель


## Цель

- Продолжение работы с Rocky Linux, приобретение практических навыков по конфигурированию SMTP-сервера в части настройки аутентификации



# Ход работы

## Начало работы
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

Запустим виртуальную машину сервер для работы, перейдем в режим суперпользователя и в дополнительном терминале запускаем мониторинг почтовой службы
:::
::: {.column width="50%"}


![Мониторинг почтовой службы](image/1.jpg)


:::
::::::::::::::

## Протоколы
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

![Добавление протокола LMTP](image/2.jpg)
:::
::: {.column width="50%"}

Добавляем в список протоколов, с которыми может работать Dovecot, протокол LMTP

:::
::::::::::::::

## Настройка сервиса
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

Настраиваем в Dovecot сервис lmtp для связи с Postfix. Эта запись определяет расположение файла с описанием прослушиваемого unix-сокета, а также задаёт права доступа к нему и определяет принадлежность к группе и пользователю postfix.
:::
::: {.column width="50%"}

![Настройка LMTP](image/3.jpg)

:::
::::::::::::::


## Настройка сервиса
:::::::::::::: {.columns align=center}
::: {.column width="45%"}

![Переопределение и перезапуск](image/4.jpg)
:::
::: {.column width="50%"}

Также переопределяем в Postfix с помощью postconf передачу сообщений не на прямую,
а через заданный unix-сокет.  В файле /etc/dovecot/conf.d/10-auth.conf задаем формат имени пользователя для аутентификации в форме логина пользователя без указания домена и перезапускаем Postfix и Dovecot.
:::
::::::::::::::

## Письмо
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

![Отправка письма](image/5.jpg)
:::
::: {.column width="50%"}

![Лог](image/6.jpg)
:::
::::::::::::::

## Проверка
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

На сервере просмотрим почтовый ящик пользователя, убедимся что отправленное с клиента письмо доставлено в почтовый ящик.
:::
::: {.column width="50%"}
![Проверка почтового ящика(image/7.jpg)
:::
::::::::::::::


## Настройка
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

![Работа служб](image/8.jpg)

:::
::: {.column width="50%"}

![Службы](image/9.jpg)
:::
::::::::::::::

## Настройка SMTP-аутентификации
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

В файле /etc/dovecot/conf.d/10-master.conf определим службу аутентификации. Указываем группу, пользователя, права доступа, тем самым беспечиваем безопасность: Postfix имеет доступ только к сокету аутентификации, но не к внутренней пользовательской базе Dovecot.

:::
::: {.column width="40%"}
![Настройка службы аутентификации](image/8.jpg)
:::
::::::::::::::


## Настройка SMTP-аутентификации
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

![Настройка SASL аутентификации](image/9.jpg)
:::
::: {.column width="40%"}
Для Postfix задаем тип аутентификации SASL для smtpd и путь к соответствующему unix-сокету.

:::
::::::::::::::

## Настройка SMTP-аутентификации
:::::::::::::: {.columns align=center}
::: {.column width="50%"}

Настроим Postfix для приёма почты из Интернета только для обслуживаемых нашим сервером пользователей или для произвольных пользователей локальной
машины, обеспечивая тем самым запрет на использование почтового сервера в качестве SMTP relay для спам-рассылок.
:::
::: {.column width="50%"}


![Настройка приема почты](image/10_1.jpg)
:::
::::::::::::::

## Запуск SMTP-сервера (порт 25) 
:::::::::::::: {.columns align=center}
::: {.column width="40%"}

![/etc/postfix/master.cf ](image/10.jpg)
:::
::: {.column width="50%"}

![Перезапуск](image/11.jpg)
:::
::::::::::::::

## Telnet
:::::::::::::: {.columns align=center}
::: {.column width="50%"}


![Установка](image/12.jpg)
:::
::: {.column width="50%"}
Далее на клиенте устанавливаем telnet
:::
::::::::::::::

## Сессия
:::::::::::::: {.columns align=center}
::: {.column width="50%"}
На клиенте получим строку для аутентификации, подключимся к SMTP-серверу посредством telnet, протестируем  соединение, проверим авторизацию и завершим сессию.
:::
::: {.column width="50%"}

![Получение строки, сессия telnet ](image/13.jpg)
:::
::::::::::::::

## Настройка SMTP over TLS
:::::::::::::: {.columns align=center}
::: {.column width="50%"}
![Конфигурация Postfix](image/14.jpg)
:::
::: {.column width="50%"}

Скопируем файлы сертификата и ключа, сконфигурируем Postfix, указав пути к сертификату и ключу, а также к каталогу для хранения TLS-сессий и уровень безопасности.
:::
::::::::::::::

## Настройка SMTP over TLS
:::::::::::::: {.columns align=center}
::: {.column width="50%"}
Заменим строки и добавим запись в файле для запуска сервера на порту 587.
:::
::: {.column width="50%"}
![/etc/postfix/master.cf](image/15.jpg)
:::
::::::::::::::


## Настройка SMTP over TLS
:::::::::::::: {.columns align=center}
::: {.column width="50%"}
![Настройка firewall](image/16.jpg)
:::
::: {.column width="50%"}
Также настроим межсетевой экран, разрешив работать службе smtp-submission и перезапустим службу

:::
::::::::::::::

## Настройка SMTP over TLS
:::::::::::::: {.columns align=center}
::: {.column width="50%"}
![Подключение к SMTP-серверу](image/17.jpg)
:::
::: {.column width="50%"}
![Тестирование подключения](image/18.jpg)

:::
::::::::::::::

## Проверка Evolution
:::::::::::::: {.columns align=center}
::: {.column width="50%"}
Наконец, проверим корректность отправки почтовых сообщений с клиента посредством почтового клиента Evolution. Корректируем настройки учётной записи, а именно для SMTP-сервера указавыем порт 587, STARTTLS и обычный пароль
:::
::: {.column width="50%"}
![Evolution](image/18.jpg)

:::
::::::::::::::

## Сохранение изменений. Скрипты
:::::::::::::: {.columns align=center}
::: {.column width="50%"}
![Скрипт на сервере](image/19.jpg)
:::
::: {.column width="50%"}
![Скрипт на клиенте](image/20.jpg)

:::
::::::::::::::




# Вывод

## Вывод

-  В ходе работы были приобретены практические навыки по конфигурированию SMTP-сервера в части настройки аутентификации, в частности настройка приема почты, настройка SMTP over TLS.
